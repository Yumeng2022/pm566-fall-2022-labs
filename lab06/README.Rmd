---
title: "Lab 06"
author: "Yumeng Gao"
date: "`r Sys.Date()`"
output: github_document
always_allow_html: true
---

```{r}
library(webshot)
webshot::install_phantomjs()
```

```{r install-libraries}
library(R.utils)
library(lubridate)
library(tidyverse)
library(tidytext)
library(dplyr)
library(dtplyr)
library(data.table)
library(tidyr)
library(ggplot2)
library(forcats)
```

## Read in the data
First download and then read in csv.
```{r read-data, cache= TRUE}
if (!file.exists("mtsamples.csv")) {
  download.file(
    url = "https://raw.githubusercontent.com/USCbiostats/data-science-data/master/00_mtsamples/mtsamples.csv",
    "mtsamples.csv", method = "libcurl", timeout  = 60)
}
mts <- read.csv("mtsamples.csv")
str(mts)
mts= as_tibble(mts)
mts
```

## Question 1: What specialties do we have?
We can use count() from dplyr to figure out how many records are there per specialty? 
```{r mdeical_specialties}
specialties=
  mts %>%
  count(medical_specialty)

specialties %>%
  arrange(desc(n)) %>%
knitr::kable()
```

There are `r nrow(specialties)` medical specialties.

```{r barplot-of-specialty-counts}
specialties %>%
  top_n(10) %>%
  ggplot( aes(x= n, y= fct_reorder(medical_specialty, n))) +
  geom_col()
```

The distribution is not at all uniform.

## Question 2: Visualize the top 20 most frequent words in the transcription column

* Tokenize the the words in the transcription column
* Count the number of times each token appears
* Visualize the top 20 most frequent words

Explain what we see from this result. Does it makes sense? What insights (if any) do we get?


```{r}
mts %>%
  unnest_tokens(word, transcription) %>%
  #anti_join(stop_words, by = c("word")) %>%
  count(word, sort = TRUE) %>%
  top_n(20, n) %>%
  ggplot(aes(n, fct_reorder(word, n))) +
  geom_col()
```

There are a lot of stop words here, non-specific to medical text,
We do see "patient".

## Question 3
* Redo visualization but remove stopwords before
* Bonus points if you remove numbers as well

```{r, cache=TRUE}
mts %>%
  unnest_tokens(word, transcription) %>%
  count(word, sort = TRUE) %>%
  anti_join(stop_words, by = c("word")) %>%
  # use regular expression to filter out numbers (not match 0-9)
  filter( !grepl(pattern= "^[0-9]+$", x= word)) %>%
  top_n(20, n) %>%
  ggplot(aes(n, fct_reorder(word, n))) +
  geom_col()
```


















































